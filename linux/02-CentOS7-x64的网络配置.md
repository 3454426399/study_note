## CentOS7-x64配置动态IP地址

所谓动态IP地址，就是机器每次启动获得的IP地址可能不一样，这是由DHCP协议实现的.

配置动态IP地址，需要编辑网卡的配置文件 `/etc/sysconfig/network-scripts/ifcfg-enp0s3` ，其中，enp0s3是对应网卡的名字，如下：

```shell
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="dhcp"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="enp0s3"
UUID="99899061-c549-4cce-9c68-9a74304d360f"
DEVICE="enp0s3"
ONBOOT="yes"
```

只要修改第四行即可，把BOOTPROTO的属性值设置成dhcp，意思是启用DHCP协议，让本地dhcp服务器为CentOS7-x64分配IP地址，然后需要输入命令重启网络：

```shell
systemctl restart network
```

网络重启后，输入ifconfig命令进行验证：

```shell
[root@localhost ~]# ifconfig
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.2.104  netmask 255.255.255.0  broadcast 192.168.2.255
        inet6 fe80::ce71:4bb5:a3a0:94c0  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:ab:90:47  txqueuelen 1000  (Ethernet)
        RX packets 1656  bytes 151476 (147.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1066  bytes 125319 (122.3 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

可以看到，IP地址就是动态分配的了，其实，不仅IP地址是动态分配的，本地DNS域名解析服务器也是通过DHCP协议动态分配的，查看 `/etc/resolv.conf` 文件，内容如下：

```shell
[root@localhost ~]# cat /etc/resolv.conf 
# Generated by NetworkManager
search DHCP HOST
nameserver 45.113.201.38
nameserver 114.114.114.114
```

最后，来一次内外网ping通测试：

```shell
[root@localhost ~]# ping 192.168.2.102 -c 4
PING 192.168.2.102 (192.168.2.102) 56(84) bytes of data.
64 bytes from 192.168.2.102: icmp_seq=1 ttl=64 time=0.999 ms
64 bytes from 192.168.2.102: icmp_seq=2 ttl=64 time=0.591 ms
64 bytes from 192.168.2.102: icmp_seq=3 ttl=64 time=0.464 ms
64 bytes from 192.168.2.102: icmp_seq=4 ttl=64 time=0.499 ms

--- 192.168.2.102 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3008ms
rtt min/avg/max/mdev = 0.464/0.638/0.999/0.214 ms
[root@localhost ~]# ping 192.168.2.1 -c 4
PING 192.168.2.1 (192.168.2.1) 56(84) bytes of data.
64 bytes from 192.168.2.1: icmp_seq=1 ttl=64 time=3.72 ms
64 bytes from 192.168.2.1: icmp_seq=2 ttl=64 time=3.26 ms
64 bytes from 192.168.2.1: icmp_seq=3 ttl=64 time=69.6 ms
64 bytes from 192.168.2.1: icmp_seq=4 ttl=64 time=4.29 ms

--- 192.168.2.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3006ms
rtt min/avg/max/mdev = 3.264/20.244/69.692/28.551 ms
[root@localhost ~]# ping -n www.baidu.com -c 4
PING www.baidu.com (183.232.231.172) 56(84) bytes of data.
64 bytes from 183.232.231.172: icmp_seq=1 ttl=56 time=24.4 ms
64 bytes from 183.232.231.172: icmp_seq=2 ttl=56 time=25.7 ms
64 bytes from 183.232.231.172: icmp_seq=3 ttl=56 time=22.2 ms
64 bytes from 183.232.231.172: icmp_seq=4 ttl=56 time=22.2 ms

--- www.baidu.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3011ms
rtt min/avg/max/mdev = 22.263/23.706/25.783/1.511 ms
```

从内网主机、网关到外网都能ping通，证明动态IP地址已经配置正确.



## CentOS7-x64配置静态IP地址

所谓静态IP地址，就是机器每次启动获得的IP地址都是一样的.

配置静态IP地址，同样需要编辑网卡的配置文件 `/etc/sysconfig/network-scripts/ifcfg-enp0s3` ，其中enp0s3是对应网卡的名字，如下：

```shell
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="static"
IPADDR="192.168.2.32"
NETMASK="255.255.255.0"
GATEWAY="192.168.2.1"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="enp0s3"
UUID="99899061-c549-4cce-9c68-9a74304d360f"
DEVICE="enp0s3"
ONBOOT="yes"
```

修改第四行，将BOOTPROTO的属性值设置成static，意思是为CentOS7-x64设置固定的IP地址；新增IPADDR、NETMASK、GATEWAY这三个属性，含义分别是本机IP地址、网络掩码、网关IP地址，根据所处网络进行设置即可，设置完成后，同样需要输入下面命令重启网络：

```shell
systemctl restart network
```

网络重启后，输入ifconfig命令进行验证：

```shell
[root@localhost ~]# ifconfig
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.2.32  netmask 255.255.255.0  broadcast 192.168.2.255
        inet6 fe80::ce71:4bb5:a3a0:94c0  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:ab:90:47  txqueuelen 1000  (Ethernet)
        RX packets 3593  bytes 322459 (314.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 2192  bytes 270230 (263.8 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 16  bytes 1364 (1.3 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 16  bytes 1364 (1.3 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

可以看到，IP地址就是静态固定的了，但是此时，本地DNS域名解析服务器就没有配置了，查看 `/etc/resolv.conf` 文件，如下：

```shell
[root@localhost ~]# cat /etc/resolv.conf 
# Generated by NetworkManager
```

因此，需要编辑 `/etc/resolv.conf` 文件，手动配置DNS域名解析服务器，编辑如下：

```shell
# Generated by NetworkManager
nameserver 114.114.114.114
nameserver 8.8.8.8
```

再次重启网络：

```shell
systemctl restart network
```

最后，来一次内外网ping通测试：

```shell
[root@localhost ~]# ping 192.168.2.102 -c 4
PING 192.168.2.102 (192.168.2.102) 56(84) bytes of data.
64 bytes from 192.168.2.102: icmp_seq=1 ttl=64 time=0.512 ms
64 bytes from 192.168.2.102: icmp_seq=2 ttl=64 time=0.708 ms
64 bytes from 192.168.2.102: icmp_seq=3 ttl=64 time=0.543 ms
64 bytes from 192.168.2.102: icmp_seq=4 ttl=64 time=0.660 ms

--- 192.168.2.102 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3004ms
rtt min/avg/max/mdev = 0.512/0.605/0.708/0.086 ms
[root@localhost ~]# ping 192.168.2.1 -c 4
PING 192.168.2.1 (192.168.2.1) 56(84) bytes of data.
64 bytes from 192.168.2.1: icmp_seq=1 ttl=64 time=3.09 ms
64 bytes from 192.168.2.1: icmp_seq=2 ttl=64 time=3.54 ms
64 bytes from 192.168.2.1: icmp_seq=3 ttl=64 time=3.06 ms
64 bytes from 192.168.2.1: icmp_seq=4 ttl=64 time=5.19 ms

--- 192.168.2.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3011ms
rtt min/avg/max/mdev = 3.062/3.725/5.199/0.875 ms
[root@localhost ~]# ping -n www.baidu.com -c 4
PING www.baidu.com (183.232.231.174) 56(84) bytes of data.
64 bytes from 183.232.231.174: icmp_seq=1 ttl=56 time=18.5 ms
64 bytes from 183.232.231.174: icmp_seq=2 ttl=56 time=20.5 ms
64 bytes from 183.232.231.174: icmp_seq=3 ttl=56 time=19.9 ms
64 bytes from 183.232.231.174: icmp_seq=4 ttl=56 time=19.9 ms

--- www.baidu.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3011ms
rtt min/avg/max/mdev = 18.592/19.752/20.572/0.734 ms
```

从内网主机、网关到外网都能ping通，证明静态IP地址已经配置正确.



## CentOS7-x64管理网络

开启网络服务：

```shell
systemctl start network
```

关闭网络服务：

```shell
systemctl stop network
```

重启网络服务：

```shell
systemctl restart network
```

查看网络服务状态：

```shell
systemctl status network
```



## CentOS7-x64管理防火墙

开启防火墙：

```shell
systemctl start firewalld
```

关闭防火墙：

```shell
systemctl stop firewalld
```

重启防火墙：

```shell
systemctl restart firewalld
```

查看防火墙状态：

```shell
systemctl status firewalld
```

设置防火墙开机自启动：

```shell
systemctl enable firewalld
```

禁止防火墙开机自启动：

```shell
systemctl disable firewalld
```

查看防火墙对外开放的端口：

```shell
firewall-cmd --list-port
```

对外开放80tcp端口(需要重启防火墙才生效)：

```shell
firewall-cmd --zone=public --add-port=80/tcp --permanent
```

对外关闭80tcp端口(需要重启防火墙才生效)：

```shell
firewall-cmd --zone=public --remove-port=80/tcp --permanent
```
